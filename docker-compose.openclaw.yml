# Отдельный compose для OpenClaw ботов.
# Используется когда web-приложение запущено через PM2 (не Docker).
# OpenClaw обращается к PM2-приложению через host.docker.internal:3000
#
# Запуск:
#   docker compose -f docker-compose.openclaw.yml --env-file .env.openclaw up -d

services:

  # ================================
  # OpenClaw — Content Manager Bot
  # @Cargo_content_manager282bot
  # Публикует статьи / категории / теги в базу знаний
  # ================================
  openclaw-content:
    image: ghcr.io/openclaw/openclaw:latest
    user: "0:0"
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      HOME: /home/node
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_CONTENT_BOT_TOKEN}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
      BOT_API_KEY: ${BOT_API_KEY}
      CARGO_API_URL: http://host.docker.internal:3000
    volumes:
      - ./openclaw/content/openclaw.json:/home/node/.openclaw/openclaw.json
      - ./openclaw/content/workspace:/home/node/.openclaw/workspace
      - openclaw_content_home:/home/node/.openclaw

  # ================================
  # OpenClaw — Product Manager / Analyst Bot
  # @CargoProductManager_888bot
  # Анализирует приложение, отвечает на вопросы, даёт советы
  # ================================
  openclaw-analyst:
    image: ghcr.io/openclaw/openclaw:latest
    user: "0:0"
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      HOME: /home/node
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_ANALYST_BOT_TOKEN}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
    volumes:
      - ./openclaw/analyst/openclaw.json:/home/node/.openclaw/openclaw.json
      - ./openclaw/analyst/workspace:/home/node/.openclaw/workspace
      - openclaw_analyst_home:/home/node/.openclaw
      - ./:/workspace/codebase:ro

volumes:
  openclaw_content_home:
  openclaw_analyst_home:
